KISSY.add("xh/comment/1.0/cdata",function(a,b,c,d,e,f,g,h){var k,l,i={};return a.JSON,k=a.Event,l=window.xhnc_commentLanguage||{},c.extend(i,{urls:{server:"http://comment.home.news.cn/",news:"http://comment.home.news.cn/a/newsInfo.do",login:"http://comment.home.news.cn/a/ajaxLogin.do",logout:"http://comment.home.news.cn/a/ajaxLogout.do",logstatus:"http://comment.home.news.cn/a/checkLoginStatus.do",watch:"http://comment.home.news.cn/a/addRelationAction.do",comment:"http://comment.home.news.cn/a/newsCommAll.do",commentSingle:"http://comment.home.news.cn/a/newsComm.do",commentHot:"http://comment.home.news.cn/a/commentsHot.do",ad:"http://comment.home.news.cn/a/advertPic.do",type:"http://comment.home.news.cn/a/newsGroup.do",turn:"http://comment.home.news.cn/a/dynamicPic.do",register:"http://my.home.news.cn/profile/passport.do",reply:"http://comment.home.news.cn/a/adComment.do",help:"http://blog.home.news.cn/help/help.html",report:"http://comment.home.news.cn/a/addReportAction.do",say:"http://comment.home.news.cn/a/everybodyTalk.do",ding:"http://comment.home.news.cn/a/commentUp.do",xml:{detail:"http://comment.home.news.cn/topxml/chart_day_all.xml",day:"http://comment.home.news.cn/topxml/chart_day_",month:"http://comment.home.news.cn/topxml/chart_month_"},detail:"http://comment.home.news.cn/"+(l.language&&"zh"!=l.language?l.language+"_":"")+"nc/",access:"http://172.18.11.67:9999/news/access",checkUserName:"http://172.18.11.67:9999/news/checkUserName",registerAction:"http://172.18.11.67:9999/news/register",icon:"http://comment.home.news.cn/images/icon_39x39.gif",userIcon:"http://tpic.home.news.cn/userIcon/s/",validateIcon:"http://login.home.news.cn/97572558abc.code2",forget:"http://login.home.news.cn/getPwd.jsp",err404:"http://comment.home.news.cn/404.html"},cookie:{comments:{key:"wdlast",value:null}},tip:{err:l.err,err500:l.err500,err403:l.err403,err404:l.err404,errIllegal:l.errIllegal},data:{serverCookie:{appName:null,sid:null},user:{},news:{},page:{},more:3},queryCookie:function(a){var b=this.cookie[a],c=new RegExp(b["key"]+"=(.*?)(?=;|$)","g");return b["value"]=c.exec(document.cookie)[1],b["value"]},getCookie:function(){return this.data.cookie},queryAD:function(a,b){var c=this;d.jsonp(this.urls.ad,!1,function(b,c){a(c)},function(){b(null,c.tip.err)})},queryTurn:function(a,b){var c=this;d.jsonp(this.urls.turn,!1,function(b,c){a(c)},function(){b(null,c.tip.err)})},queryType:function(a,b){var c=this;d.jsonp(this.urls.type,!1,function(b,c){a(c)},function(){b(null,c.tip.err)})},queryNewsId:function(a){var b,c,e,f,g;return this.querySite(),"object"==typeof a&&a&&(b=a.params.newsId)?b:(c=d.query(),c.newsId||(e=window.location.pathname,f=/.*\/[a-zA-Z_]*nc\/([a-zA-Z0-9-]*)\.(html|htm)(.*)/i,g=f.exec(e),null!=g?c.newsId=g[1]:(f=/.*\/c_([^_]*)(_\d+)?\.(htm|html)(.*)/i,g=f.exec(e),null!=g?c.newsId=this.getPrefix()+g[1]:(f=/.*\/(.*)\.(htm|html)(.*)/i,g=f.exec(e),c.newsId=null!=g?this.getPrefix()+g[1]:null))),c.newsId)},queryUserStatus:function(a,b){var e=this;d.jsonp(this.urls.logstatus,null,function(d,f){f.content&&c.extend(e.data.serverCookie,f.content,!0),200==f.code?a(f):500==f.code?b(f,e.tip.err500):b(f,f.description),f.content&&c.extend(e.data.cookie,f.content)},function(){b(null,e.tip.err)})},queryNews:function(a,b,e){var g,f={newsId:null};c.extend(f,a),g=this,d.jsonp(this.urls.news+"?"+c.serialize(f),!1,function(a,c){404==c.code?e(c,g.tip.err404):500==c.code?e(c.code,g.tip.err500):(c.detailUrl=g.urls.detail+c.newsId+".html",b(c))},function(){e(null,g.tip.err)})},queryCommentHot:function(a,b,e){var g,f={newsId:null,pid:null};c.extend(f,a),g=this,d.jsonp(this.urls.commentHot+"?"+c.serialize(f),!1,function(a,c){return"string"==typeof c.contentAll?(b({newsId:f.newsId,url:"javascript:;",totalRow:0,currentPage:f.pid,icon:g.urls.icon,contentAll:[]}),void 0):(c.newsId=f.newsId,c.url=g.urls.detail+f.newsId+".html",c.icon=g.urls.icon,b(c),void 0)},function(){e(null,g.tip.err)})},queryCommentLatest:function(a,b,e){var g,f={newsId:null,pid:1};c.extend(f,a),g=this,("undefined"==typeof f.pid||null===f.pid)&&(f.pid=1),d.jsonp(this.urls.comment+"?"+c.serialize(f),!1,function(a,c){return"string"==typeof c.contentAll?(b({newsId:f.newsId,url:"javascript:;",totalRow:0,currentPage:f.pid,icon:g.urls.icon,contentAll:[]}),void 0):(c.newsId=f.newsId,c.url=g.urls.detail+f.newsId+".html",c.icon=g.urls.icon,b(c),void 0)},function(){e(null,g.tip.err)})},queryCommentSingle:function(a,b,e){var g,f={newsId:null};c.extend(f,a),g=this,d.jsonp(this.urls.commentSingle+"?"+c.serialize(f),!1,function(a,c){return"string"==typeof c.contentAll?(b({newsId:f.newsId,url:"javascript:;",totalRow:0,currentPage:f.pid,icon:g.urls.icon,contentAll:[]}),void 0):(c.newsId=f.newsId,c.url=g.urls.detail+f.newsId+".html",c.icon=g.urls.icon,b(c),void 0)},function(){e(null,g.tip.err)})},queryXML:function(a,b,d){var g,h,i,e={type:null,value:null};return c.extend(e,a),g=this,h=this.urls.xml,(i="detail"==e.type?h.detail:"day"==e.type?h.day+e.value+".xml":"month"==e.type?h.month+e.value+".xml":!1)?(f({dataType:"xml",url:encodeURI(i+"?ver="+(new Date).getTime()+"_"+Math.floor(1e4*Math.random())),type:"get",success:function(a){b(a)},error:function(){d(null,g.tip.err)}}),void 0):(d(null,l.formatErr),void 0)},querySay:function(a,b){var c=this;d.jsonp(this.urls.say,!1,function(b,c){a(c)},function(){b(null,c.tip.err)})},queryAccess:function(a,b,e){var g,f={};c.extend(f,a,!0),g=this,d.jsonp(this.urls.access+"?"+c.serialize(f),!1,function(a,c){b(c)},function(){e(null,g.tip.err)})},queryCheckUserName:function(a,b,e){var g,f={username:null};c.extend(f,a,!0),g=this,d.jsonp(this.urls.checkUserName+"?"+c.serialize(f),!1,function(){},function(){e(null,g.tip.err)})},setUser:function(a){return null==a?this.data.user={}:(c.extend(this.data.user,a,!0),this.data.user.zone="zh"==l.language?"http://"+this.data.user.username+".home.news.cn/":"javascript:void(0);"),this.data.user},getUser:function(){return this.data.user},setNews:function(a){return null==a?this.data.news={}:c.extend(this.data.news,a,!0),this.data.news},getNews:function(){return this.data.news},hightlightReply:function(a,b,c){var d=e.one(a),f=e.one(b);c||(c=l.replyPlaceholder),k.fire(d,"focus"),d.animate({"background-color":"#FFBFBF"},{duration:.5}).animate({"background-color":"#FFF"},{duration:1}),f&&f.html(c)},checkReply:function(a,c,d,f){var g=e.one(a),h=e.one(c),j=b.trim(g.val()),m=i.getUser(),n=i.getSite(),o="number"!=typeof d?300:d>0?d:300;return o=parseInt(o),!n.cl||m.userid&&m.username&&m.nickname?0===j.length?(g.val(""),k.fire(g,"focus"),g.animate({"background-color":"#FFBFBF"},{duration:.5}).animate({"background-color":"#FFF"},{duration:1}),h&&h.html(l.replyPlaceholder),!1):j.length>o?(k.fire(g,"focus"),g.animate({"background-color":"#FFBFBF"},{duration:.5}).animate({"background-color":"#FFF"},{duration:1}),h&&h.html(l.lengthStart+o+l.lengthEnd),!1):(h&&h.html(""),j):(f(),!1)},submitReply:function(a,b,e,g){var j,k,l,h=this,i={newsId:null,content:"",parentId:null,shareToWb:0,sourceId:1,type:"",rurl:null};if(c.extend(i,a),("undefined"==typeof i.shareToWb||null==i.shareToWb)&&(i.shareToWb=0),j=function(a){"200"===a.code||200===a.code?b(a):403==a.code?e(a,h.tip.err403):500==a.code?e(a,h.tip.err500):e(a,h.tip.errIllegal)},k=function(){e(null,h.tip.err)},g){for(l in i)(void 0===i[l]||null===i[l])&&(i[l]="");f.post(this.urls.reply,i,function(a){j(a)},"json")}else d.jsonp(this.urls.reply+"?"+c.serialize(i),!1,function(a,b){j(b)},function(){k()})},submitWatch:function(a,b,e){var f=this,g={method:"add",operUserId:null,targetUserId:null};c.extend(g,a),d.jsonp(this.urls.watch+"?"+c.serialize(g),!1,function(a,c){200==c.code?b(c):500==c.code?e(c,f.tip.err500):e(c,l.followErr)},function(){e(null,f.tip.err)})},submitLogout:function(a,b){var c=this;d.jsonp(this.urls.logout,null,function(d,e){200==e.code?a(e):500==e.code?b(e,c.tip.err500):b(e,c.tip.errIllegal)},function(){b(null,c.tip.err)})},submitLogin:function(a,b,e){var g,f={username:null,password:null};c.extend(f,a),g=this,d.jsonp(this.urls.login+"?"+c.serialize(f),null,function(a,c){200==c.result?b(c):e(c,l.loginErr)},function(){e(null,g.tip.err)})},submitReport:function(a,b,e){var g,f={commentId:null,uid:null,type:null,more:null,reportUserId:null};c.extend(f,a),g=this,d.jsonp(this.urls.report+"?"+c.serialize(f),null,function(a,c){200==c.code?b(c):e(c,l.reportErr)},function(){e(null,g.tip.err)})},submitDing:function(a,b,e){var g,f={commentId:null,newsId:null};c.extend(f,a),g=this,d.jsonp(this.urls.ding+"?"+c.serialize(f),null,function(a,c){b&&b(c)},function(){e&&e(null,g.tip.err)})},submitRegister:function(a,b,e){var g,f={};c.extend(f,a,!0),g=this,d.jsonp(this.urls.registerAction+"?"+c.serialize(f),!1,function(a,c){b&&b(c)},function(){e&&e(null,g.tip.err)})},connectionInit:function(){h.init("qqweibo")},connectionQQWeibo:function(a,b,c){if(g){var d=this.data.serverCookie;g.weibo.config.data={coAppName:d.appName,coSessionId:d.sid}}h.login("qqweibo",{success:function(c){c.code=201,i.queryAccess(c,function(b){a&&a(b)},function(a,c){b&&b(c,200)})},error:function(){b&&b(l.authorizeErr,-200)},loading:function(){c&&c(l.authorizeWait)}})},connectionQQWeiboSet:function(a){g&&c.extend(g.weibo,a,!0)},connectionQQWeiboServer:function(){g&&g.weibo.server()},siteInfo:{defaultValue:1,connector:"-",elId:"xhnc_commentSite",el:null,site:null,prefix:"",cl:!1},querySite:function(){var a=this.siteInfo;return a.site||(window.xhnc_commentOption&&window.xhnc_commentOption.site?a.site=window.xhnc_commentOption.site:(a.el=a.el?a.el:e.one("#"+a.elId),a.site=a.el&&a.el.val()?a.el.val():a.defaultValue),a.prefix=a.site+a.connector,window.xhnc_commentOption&&"undefined"!=typeof window.xhnc_commentOption.cl&&(a.cl=window.xhnc_commentOption.cl)),a},getSite:function(){return this.siteInfo},getPrefix:function(){return this.siteInfo.prefix}}),i},{requires:["xh/common/1.0/text","xh/common/1.0/lang","xh/common/1.0/url","node","ajax","xh/connection/qq","xh/connection/1.0/index"]});