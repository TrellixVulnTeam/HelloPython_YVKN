/**
 * 评论对话框统一接口
 * @version 1.2.3
 */
KISSY.add("xh/comment/1.0/cdialog",function(a,b,c,d,e,f,g,h){var i={},j=h.all,k=window.xhnc_commentLanguage||{};return i.effect=i.effect||{},b.extend(i.effect,{inputFlash:function(a){var b=h.one(a);b.isRunning()||b.animate({"background-color":"#FFBFBF"},{duration:.5}).animate({"background-color":"#FFF"},{duration:1})}},!0),b.extend(i,{base:function(){var c=function(){this.pos=[1,2,3,4,5,6,7,8,9,0],this.opts={fixed:!0,pos:0,duration:.5,open:!0,modal:!0,html:{title:k.optsDialogTitle,article:""},className:{container:"comment-dialog "+k.language,header:"header",title:"title",close:"close",article:"article",modal:"comment-dialog-modal"},event:{open:function(){},close:function(){},init:function(){}}},this.pos={top:0,left:0},this.id="",this.entity=null,this.ie6=a.UA.ie&&a.UA.ie<7,this.fixedEvt=null,this.binded=!1,this.modal=!1};return b.extend(c.prototype,{_init:function(){var a,c,d,e,f;this.id="COMMENT_ID_"+(new Date).getTime(),a=this.opts,c=this.opts.className,d=this.opts.html,e=b.createNode({tag:"div",id:this.id,className:c.container,innerHTML:'<div class="'+c.header+'"><div class="'+c.title+'" id="'+this.id+'_title">'+d.title+'</div><div class="'+c.close+'" id="'+this.id+'_close"></div></div>',children:[{tag:"div",className:c.article,innerHTML:d.article}]}),this.entity=e,this.close(),e.style.position="absolute",document.body.appendChild(e),f=document.createElement("div"),f.className=c.modal,f.style.position="absolute",f.style.display="none",f.style.top="0px",f.style.left="0px",f.style.width=j(document).outerWidth(!0)+"px",f.style.width=j(document).outerHeight(!0)+"px",document.body.appendChild(f),this.modal=f,this._install(),this.relocation(a.pos),this.fixed(a.fixed),this.show(a.open),this.ie6&&this._action()},_action:function(){var a=h,d=this._fixedPos();this.ie6&&(d.left+=document.documentElement.scrollLeft,d.top+=document.documentElement.scrollTop),a.one(this.entity).animate({left:d.left,top:d.top},{duration:this.opts.duration,queue:!1})},_install:function(){var i,c=a.Event,f=a.DOM;this.opts.event,i=this,c.add("#"+this.id+"_close","click",function(){i.close()}),this.ie6&&(c.add("#"+this.id+"_close","mouseenter",function(){f.addClass(this,"close-selected")}),c.add("#"+this.id+"_close","mouseleave",function(){f.removeClass(this,"close-selected")})),this.fixedEvt=function(a){return function(){a.ie6?b.async({id:a.id,reload:!0,timer:120,fn:function(){a._action()}}):a._action(),j(a.modal).width(j(document).outerWidth(!0)),j(a.modal).height(j(document).outerHeight(!0))}}(this),this.opts.event.init(this.id,this)},_calculatePos:function(b){var c=a.DOM,d=this.entity,e=c.outerWidth(d),f=c.outerHeight(d),g=c.viewportWidth(),h=c.viewportHeight(),i=g-e,j=h-f,k={top:"0px",left:"0px"};switch(b){case 1:break;case 2:k.left=i/2+"px";break;case 3:k.left=i+"px";break;case 4:k.left=i+"px",k.top=j/2+"px";break;case 5:k.left=i+"px",k.top=j+"px";break;case 6:k.left=i/2+"px",k.top=j+"px";break;case 7:k.top=j+"px";break;case 8:k.top=j/2+"px";break;default:k.left=i/2+"px",k.top=j/2+"px"}return k},_fixedPos:function(){var b=a.DOM,c=this.entity,d=b.viewportWidth(),e=b.viewportHeight(),f=b.outerWidth(c),g=b.outerHeight(c);return{top:(e-g)*this.pos.top,left:(d-f)*this.pos.left}},relocation:function(b){var g,h,i,j,k,l,m,c=parseInt(b),d=this.entity,e=this.opts,f=a.DOM;"object"==typeof b?e.pos instanceof Array&&b.length>=2?(d.style.top=b[0],d.style.left=b[1]):("undefined"!=typeof b.top&&(d.style.top=b.top),"undefined"!=typeof b.left&&(d.style.left=b.left)):("number"==typeof b||"string"==typeof b&&!isNaN(c))&&(g=this._calculatePos(c),d.style.left=g.left,d.style.top=g.top),h=f.viewportWidth(),i=f.viewportHeight(),j=f.outerWidth(d),k=f.outerHeight(d),l=parseFloat(d.style.left),m=parseFloat(d.style.top),this.pos={top:m/(i-k),left:l/(h-j)}},show:function(a){this.entity.style.display=a?"block":"none",this.modal&&(this.modal.style.display=a?"block":"none",j(this.modal).width(j(document).outerWidth(!0)),j(this.modal).height(j(document).outerHeight(!0)))},open:function(){this.show(!0),this.opts.event.open()},close:function(){this.show(!1),this.opts.event.close()},fixed:function(c){var d=this.ie6,e=a.Event,f=this.entity;c?(f.style.position=d?"absolute":"fixed",null==this.fixedEvt||this.binded||(e.add(window,"resize",this.fixedEvt),d&&e.add(window,"scroll",this.fixedEvt),this.binded=!0)):(e.detach(window,"resize",this.fixedEvt),e.detach(window,"scroll",this.fixedEvt),f.style.position="absolute",this.binded=!1)}}),function(a){if("undefined"==typeof a&&(a={}),a===!1)return c;if("object"==typeof a&&!(a instanceof Array)){var d=new c;return b.extend(d.opts,a,!0),d._init(),d}return!1}}(),login:function(){var c={urls:{register:"javascript:;",help:"javascript:;",forget:"javascript:;",login:"javascript:;"},complete:function(){},success:function(){},failure:function(){},error:function(){},otherLogin:function(){}};return function(d){var f,h,l,m,n,e=i;return b.extend(c.urls,g.urls,!0),b.extend(c,d,!0),f=a.Event,h=a.DOM,l="COMMENT_LOGIN_ID_"+(new Date).getTime(),m=c.urls,n=e.base({html:{title:k.loginDialogTitle,article:'<div class="register"><div class="r-title">'+k.unused+'</div><div class="r-link"><a href="'+m.register+'" target="_blank">'+k.loginDialogReg+'</a></div></div><!-- <div class="connect"><div class="c-title">'+k.loginUnited+'</div><div class="c-link clearfix"><ul  id="'+l+'_links" ><li class="qq"><a href="javascript:;">&nbsp;</a></li><li class="more"><a href="javascript:;">'+k.more+'</a></li></ul></div></div> --><div class="login"><div class="l-title">'+k.loginTitle+'</div><div class="l-form"><div class="lf-item"><div class="lf-title">'+k.user+'</div><div class="lf-input clearfix"><div><input id="'+l+'_username" tabindex="1" type="text"></div><!-- <div><a href="'+m.help+'" target="_blank">'+k.helpCenter+'</a></div> --> </div></div><div class="lf-item"><div class="lf-title">'+k.pwd+'</div><div class="lf-input clearfix"><div><input id="'+l+'_password" tabindex="1" type="password"></div><div><a href="'+m.forget+'" target="_blank">'+k.forgetPwd+'</a></div></div></div></div><div class="l-submit"><input value="'+k.login+'" id="'+l+'_submit" type="button" tabindex="1"></div></div>'},event:{init:function(){j("#"+l+"_links > .qq").on("click",function(){g.connectionQQWeibo(function(a){c.otherLogin("qqweibo",a,void 0)},function(a){c.otherLogin("qqweibo",void 0,a)},function(){})}),f.add("#"+l+"_submit","click",function(){var a,b;a=h.val("#"+l+"_username"),b=h.val("#"+l+"_password"),g.submitLogin({username:a,password:b},function(a){c.success(a),c.complete(a)},function(a,b){null==a?c.failure(a,b):c.error(a,b),c.complete(a)})})},open:function(){f.fire("#"+l+"_username","focus")}},pos:0,open:!1})}}(),report:function(){var e={urls:{report:"javascript:;"},user:{},complete:function(){},success:function(){},failure:function(){},error:function(){},login:function(){}};return function(f){var l,m,o,q,r,t,j=i;return b.extend(e.urls,g.urls),b.extend(e,f,!0),l=a.Event,m=a.DOM,o=i.effect,q=d,r="COMMENT_REPORT_ID_"+(new Date).getTime(),e.urls,b.extend(j.base(!1).prototype,{reload:function(a,b,c,d){var e=this.entity;e.setAttribute("data-cid",a),e.setAttribute("data-uid",b),m.html("#"+r+"_report_user",c),m.html("#"+r+"_report_text",d),m.html("#"+r+"_report_tip",""),m.val("#"+r+"_report_more","")},lockUser:function(a){this.user=a}}),t=new j.base({html:{title:k.reportDialogTitle,article:'<div class="image"><div>&nbsp;</div></div><div class="info"><div class="i-title">'+k.reportText+'</div><div class="i-user">'+k.reportUser+'<span id="'+r+'_report_user">&nbsp;</span>：</div><div class="i-text" id="'+r+'_report_text">&nbsp;</div></div><div class="type"><div class="t-title">'+k.reportType+"<em>"+k.required+'</em>：</div><div class="t-type"><table><tbody><tr><td><input value="1" name="'+r+'_report_type" type="radio">'+k.sexy+'</td><td><input value="2" name="'+r+'_report_type" type="radio">'+k.advertisement+'</td><td><input value="3" name="'+r+'_report_type" type="radio">'+k.fake+'</td></tr><tr><td><input value="4" name="'+r+'_report_type" type="radio">'+k.politics+'</td><td><input value="5" name="'+r+'_report_type" type="radio">'+k.annoy+'</td><td><input value="0" name="'+r+'_report_type" checked="checked" type="radio">'+k.other+'</td></tr></tbody></table></div></div><div class="more"><div class="m-title">'+k.reportRemark+'<em id="'+r+'_report_tip"></em></div><div class="m-text"><textarea id="'+r+'_report_more"></textarea></div></div><div class="btn"><input value="'+k.sure+'" id="'+r+'_report_submit" class="submit" type="button">&nbsp;&nbsp;&nbsp;<input value="'+k.cancel+'" class="cancel" id="'+r+'_report_cancel" type="button"></div>'},event:{init:function(a,c){b.addClass(c.entity,"report-dialog"),l.add("#"+r+"_report_cancel","click",function(){c.close()}),l.add('input[name="'+r+'_report_type"]',"click",function(){0==this.value&&o.inputFlash("#"+r+"_report_more")}),l.add("#"+r+"_report_submit","click",function(){var h,i,a=c.entity,b=a.getAttribute("data-cid"),d=a.getAttribute("data-uid"),f=c.user.userid;if(!f)return e.login(),void 0;if(h=m.val("#"+r+"_report_more"),i=m.val('input[name="'+r+'_report_type"]:checked'),h=q.trim(h),m.html("#"+r+"_report_tip",""),0==i){if(h.length<=0)return o.inputFlash("#"+r+"_report_more"),l.fire("#"+r+"_report_more","focus"),m.html("#"+r+"_report_tip",k.reportOther),void 0;if(h.length>100)return o.inputFlash("#"+r+"_report_more"),l.fire("#"+r+"_report_more","focus"),m.html("#"+r+"_report_tip",k.reportCheck),void 0}h=q.htmlFilter(h),g.submitReport({commentId:b,commUserId:d,reportType:i,reportContent:h,reportUserId:f},function(a){e.success(a),e.complete(a)},function(a,b){null==a?e.failure(a,b):e.error(a,b),e.complete(a)})})}},pos:0,open:!1})}}(),quick:function(){var c={submit:function(){}};return function(){var j,e=a.DOM,f=a.Event,g="COMMENT_QUICK_ID_"+(new Date).getTime(),h=i;return b.extend(h.base(!1).prototype,{reload:function(a){e.val("#"+g+"_quick_nick",a)}}),j=h.base({html:{article:'<div class="nick"><div class="n-title">'+k.quickLoginText+'</div><div class="n-text clearfix"><div>'+k.nick+'</div><input readonly="true" id="'+g+'_quick_nick" class="value" value="" type="text"><input id="'+g+'_quick_submit" class="submit" value="'+k.sure+'" type="button"></div></div>'},event:{init:function(a,b){e.addClass(b.entity,"quick-dialog"),f.add("#"+g+"_quick_submit","click",function(){b.close(),c.submit()})}},pos:0,open:!1})}}(),register:function(){var c={submit:function(){}};return function(d){var l,m,n,e=a.DOM;return a.Event,l="COMMENT_REGISTER_ID_"+(new Date).getTime(),m=i,b.extend(m.base(!1).prototype,{reload:function(a){e.val("#"+l+"_username",a)}}),b.extend(c,d,!0),n=m.base({html:{title:k.regDialogTitle,article:"<h1>"+k.regText+'</h1><div class="register clearfix"><div class="head"></div><div class="info"><table border="0"><tr><th width="80px">'+k.user+'</th><td><div class="input"><input type="text"id="'+l+'_username" maxlength="15"/><div class="tip"></div></div></td><td>&nbsp;</td></tr><tr><th>'+k.email+'</th><td><div class="input"><input type="text"id="'+l+'_email"/><div class="tip"></div></div></td><td>&nbsp;</td></tr><tr><th>'+k.pwd+'</th><td><div class="input"><input type="password"id="'+l+'_password"/><div class="tip"></div></div></td><td>&nbsp;</td></tr><tr><th>'+k.confirmPwd+'</th><td><div class="input"><input type="password"id="'+l+'_password2"/><div class="tip"></div></div></td><td>&nbsp;</td></tr><tr><th>'+k.imgCode+'</th><td><div class="input validate clearfix"><input type="text"id="'+l+'_validate"/><img src="'+g.urls.validateIcon+'" id="'+l+'_image"/><a href="javascript:;" id="'+l+'_change">'+k.changeImgCode+'</a><div class="tip"></div></div></td><td>&nbsp;</td></tr></table></div></div><div class="btn"><input type="button" value="'+k.submitText+'" id="'+l+'_submit"/></div>'},event:{init:function(a,b){var m,d=i.effect,h=function(){j("#"+l+"_image").attr("src",g.urls.validateIcon+"?_="+Math.floor(1e3*Math.random()))};j("#"+l+"_image").on("click",h),j("#"+l+"_change").on("click",h),e.addClass(b.entity,"register-dialog"),m=new f("#"+l+"_submit",{method:"single",placeholder:function(a,b,c,e,f,g){var h=a.next(".tip"),i=a.parent().parent().next();c?(h.html(""),i.addClass("right")):(g&&d.inputFlash(a),h.html(e),i.removeClass("right"))},action:function(a){a&&g.submitRegister({},function(a){c.submit(200==a.code)&&n.close()},function(a){alert(a)})}}),m.add([{name:"#"+l+"_username",config:{required:!0,match:/^[a-z]+[a-z0-9]*$/g,between:[3,15],ajax:{url:g.urls.checkUserName,getData:function(){return{username:j("#"+l+"_username").val()}},dataType:"jsonp",cache:!1,complete:function(a){return 200==a.code}}},tip:{required:k.userRequired,match:k.userMatch,between:k.userBetween,ajax:{timeout:k.timeout,success:k.userExists}}},{name:"#"+l+"_email",config:{required:!0,email:!0},tip:{required:k.emailRequired,match:k.emailMatch}},{name:"#"+l+"_password",config:{required:!0,between:[6,20]},tip:{required:k.pwdRequired,between:k.pwdBetween,equals:k.pwdEquals}},{name:"#"+l+"_password2",config:{required:!0,between:[6,20],equals:j("#"+l+"_password")},tip:{required:k.pwdRequired,between:k.pwdBetween,equals:k.pwdEquals}},{name:"#"+l+"_validate",config:{required:!0},tip:{required:k.imgCodeRequired}}]),m.run()}},pos:0,open:!1})}}()}),i},{requires:["xh/common/1.0/lang","xh/common/1.0/url","xh/common/1.0/text","xh/common/validateConfig","xh/common/1.0/validate","../1.0/cdata","node"]});