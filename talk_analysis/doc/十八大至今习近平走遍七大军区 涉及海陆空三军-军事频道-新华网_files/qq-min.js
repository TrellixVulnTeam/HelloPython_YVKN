/**
 * 基于QQ集合的第三方接入接口，developed by Jimmy Song at 2013/06/28
 * 1.3.2 调整QQ授权方式
 * 1.3 调整QQ微博配置，使用本地弹窗以及整页弹窗的方式处理
 * 1.2 修改QQ微博配置，取消原有T.login方法，使用自定义方式进行
 * 1.1 重新继承Connection扩展
 * @version 1.3.2
 */
KISSY.add("xh/connection/qq",function(a,b,c){var d={weibo:{scriptUrl:KISSY.Config.packages.xh.base+"lib/openjs.js",config:{appkey:801366717,callbackurl:"http://comment.home.news.cn/auth.html",samewindow:!0,showappinfo:!1,autoclose:!0,serverurl:"http://login.home.news.cn/profile/cologin.do?t=qq",data:!1,query:{self:{auth_redirect:"http://comment.home.news.cn/callback/qqweibo_callback.html",callback:"qqweibo_callback_",type:"qqweibo"},blank:{auth_redirect:"http://login.home.news.cn/cb/qq2.do",callback:function(){var a=window.location.href,b=a.indexOf("#");return b>=0&&(a=a.substring(0,b)),a}(),type:"qqweibo"}},hash:{appkey:801366717},width:647,height:610},server:function(){window.location.href=this.config.serverurl}}},e=!1;return KISSY.ConnectionConfig.add({name:"qqweibo",overwrite:!0,version:1,init:function(a){c.appendScript({src:d.weibo.scriptUrl,success:function(){c.async({timer:200,fn:function(){var b=d.weibo.config;T.init(b),a.success()}})},error:function(){a.error()}})},login:function(a){var b,f,g,h,i,j,k,l,m;T.logout(),b=d.weibo.config,f=b.callbackurl,g=(window.screen.availWidth-b.width)/2,h=(window.screen.availHeight-b.height)/2,i=(new Date).getTime(),window["qqweibo_callback_"+i+"_success_"+b.appkey]=function(a){return function(b){a.success(b),delete arguments.callee}}(a),window["qqweibo_callback_"+i+"_error_"+b.appkey]=function(a){return function(b){a.error(b),delete arguments.callee}}(a),j=c.serialize(b.hash),k={},c.extend(k,b.samewindow?b.query.blank:b.query.self),b.samewindow||(k.callback="qqweibo_callback_"+i),b.data&&(l=k.auth_redirect.indexOf("?"),m="","object"==typeof b.data?m=c.serialize(b.data):"string"==typeof b.data&&(m=b.data),k.auth_redirect+=(l>=0?"&":"?")+m),k.auth_redirect=encodeURIComponent(encodeURIComponent(k.auth_redirect)),k=c.serialize(k),f+="?"+k+"#"+j,f=encodeURIComponent(encodeURI(f)),url="https://open.t.qq.com/cgi-bin/oauth2/authorize?response_type=token&client_id="+b.appkey+"&redirect_uri="+f+"&scope=all",b.samewindow?window.location.href=url:(e=window.open(url,"qqweibo","left="+g+",top="+h+",width="+b.width+",height="+b.height+",toolbar=no,menubar=no,scrollbars=yes,resizable=yes,location=yes,status=no"),e.focus&&e.focus())},logout:function(a){T.logout(a.success)},logstatus:function(a){a.success(T.loginStatus())}}),d},{requires:["./1.0/index","xh/common/1.0/lang"]});