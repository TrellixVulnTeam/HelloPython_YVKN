/**
 * 验证框架，建议全局配置验证脚本与规则。developed by Jimmy Song at 2013/06/20
 * 1.1 为验证框架扩展新的配置内容
 * @version 1.1 
 */
KISSY.add("xh/common/1.0/validate",function(a,b,c,d,e){var h,f=d.all;return a.Event,KISSY.ValidateConfig=KISSY.ValidateConfig||{config:function(a){b.extend(KISSY.ValidateConfig,a,!0)},add:function(a){var d,e,f,g,h,i,c=void 0;for(a instanceof Array?c=a:(c=[],c.push(a)),d=0,e=0;e<c.length;e++)f=c[e],g={name:null,exec:function(){},tip:null,overwrite:!1},b.extend(g,f,!0),/[a-zA-Z]+[a-zA-Z0-9]*/gi.test(g.name)&&(h=this.Validate.configs,i=this.Validate.tips,(!h[g.name]||g.overwrite)&&(h[g.name]=g.exec,i[g.name]=g.tip,d++));return d},patterns:function(a){return b.extend(this.Patterns,a,!0),this.Patterns},Validate:{configs:{},tips:{}},Patterns:{}},h=function(a,c){this.settings={event:"click",method:"multi",singleEvent:"blur",configs:{},tips:{},always:!1,action:function(){return!0},placeholder:function(a,b,c,d){var e=f(a).next(".validate-tip");e&&0!=e.length||f('<span class="validate-tip"><span>').insertAfter(a),f(a).next(".validate-tip").html(""),c?f(a).next(".validate-tip").html(""):f(a).next(".validate-tip").append(d)}},this.obj=f(a),this.items=[],this.trigger=!1,b.extend(this.settings,c,!0)},b.extend(h.prototype,{run:function(){var a=this.settings,b=function(a){return function(){a.trigger=!0,a.action()}}(this);null==a.event?b():f(this.obj).on(a.event,b),this.items.splice(0),this.install()},install:function(){var e,g,h,a=this.settings,b=c.trim(a.method).toLowerCase(),d=this;for(e in a.configs)g=f(e),h={name:e,dom:g,result:!1,validate:!1,ajax:0},this.items.push(h),"single"==b&&g.on(a.singleEvent,function(a){return function(){d.trigger=!1,d.validate(a)}}(h))},action:function(){var c,d,e;for(KISSY.ValidateConfig.Validate,this.settings,c=this.items,d=0;d<c.length;d++)e=c[d],e.ajax=0,e.validate=!0,e.result=!0,this.validate(e);this.callAction()},validate:function(a){var c=this.settings,d=KISSY.ValidateConfig.Validate,g=!0,h=!0,l=c.configs[a.name],m=this;a.dom.each(function(i){var n,o,p,q,r,j=f(i),k=j.val();for(n in l)if(o=d.configs[n]){if(p=function(a,b,c,d,e){return function(f,g,h){a.settings.placeholder(b,d,f.result,a.tip(e,c,d,f.label),c,0>=h)}}(m,j,n,a.name,l),q=o(j,k,l[n],{IO:e,Lang:b,complete:function(c,d){var e={result:!1,label:d};b.extend(e,c,!0),"boolean"==typeof g&&(e.result=c),a.ajax--,p(e,d,a.ajax),a.result=a.result&&e.result,a.ajax<=0&&m.trigger&&(a.ajax=0,a.validate=!0,m.callAction())}}),r=q,"string"==typeof q&&/ajax/gi.test(q)&&(h=h&&!1,a.ajax++,q=!0,r=!1),g=g&&q,c.placeholder(j,a.name,r,m.tip(l,n,a.name),n,a.ajax<=0),!r)break}else g=g&&!0}),a.result=g,a.validate=h},tip:function(a,b,c,d){var h,i,j,k,e=this.settings,f=KISSY.ValidateConfig.Validate,g=f.tips[b];if(d&&(g=g?g[d]:g),h=e.tips[c]&&e.tips[c][b]?e.tips[c][b]:!1,d&&(h=h?h[d]:!1),i=h?h:g?g:"",j=a[b],d&&(j=j?j[d]:j),j instanceof Array)for(k=0;k<i.length;k++)i=i.replace("{"+k+"}",j[k]);else{if("string"!=typeof i)return"";i=i.replace("{0}",j)}return i},callAction:function(){var d,e,a=this.items,b=!0,c=!0;for(d=0;d<a.length;d++)e=a[d],b=b&&e.validate,c=c&&e.result;b&&this.settings.action(c)},reset:function(){var b,c,a=this.items;for(b=0;b<a.length;b++)c=a[b],c.result=!1,c.ajax=0,c.validate=!1},addBatch:function(a){b.extend(this.settings,a,!0),this.items.splice(0),this.install()},add:function(a){var d,e,g,h,i,c=[];if(a instanceof Array)c=a;else{if("object"!=typeof a)return;c.push(a)}for(d=0;d<c.length;d++){if(e=c[d],g={name:null,config:{},tip:{}},b.extend(g,e,!0),"string"!=typeof g.name)return;if(h=g.config,"object"!=typeof h||null==h)return;if(this.settings.configs[g.name]=h,i=g.tip,"object"!=typeof i&&null!=i)return;this.settings.tips[g.name]=i,this.items.push({name:g.name,dom:f(g.name),result:!1,validate:!1,ajax:0}),g=null}delete c}}),h},{requires:["../1.0/lang","../1.0/text","node","ajax"]});