jQuery.effects||(function(h,e){h.effects={};h.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(n,m){h.fx.step[m]=function(o){if(!o.colorInit){o.start=l(o.elem,m);o.end=j(o.end);o.colorInit=true}o.elem.style[m]="rgb("+Math.max(Math.min(parseInt((o.pos*(o.end[0]-o.start[0]))+o.start[0],10),255),0)+","+Math.max(Math.min(parseInt((o.pos*(o.end[1]-o.start[1]))+o.start[1],10),255),0)+","+Math.max(Math.min(parseInt((o.pos*(o.end[2]-o.start[2]))+o.start[2],10),255),0)+")"}});function j(n){var m;if(n&&n.constructor==Array&&n.length==3){return n}if(m=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(n)){return[parseInt(m[1],10),parseInt(m[2],10),parseInt(m[3],10)]}if(m=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(n)){return[parseFloat(m[1])*2.55,parseFloat(m[2])*2.55,parseFloat(m[3])*2.55]}if(m=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(n)){return[parseInt(m[1],16),parseInt(m[2],16),parseInt(m[3],16)]}if(m=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(n)){return[parseInt(m[1]+m[1],16),parseInt(m[2]+m[2],16),parseInt(m[3]+m[3],16)]}if(m=/rgba\(0, 0, 0, 0\)/.exec(n)){return a.transparent}return a[h.trim(n).toLowerCase()]}function l(o,m){var n;do{n=h.curCSS(o,m);if(n!=""&&n!="transparent"||h.nodeName(o,"body")){break}m="backgroundColor"}while(o=o.parentNode);return j(n)}var a={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};var f=["add","remove","toggle"],c={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function g(){var p=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,q={},n,o;if(p&&p.length&&p[0]&&p[p[0]]){var m=p.length;while(m--){n=p[m];if(typeof p[n]=="string"){o=n.replace(/\-(\w)/g,function(r,s){return s.toUpperCase()});q[o]=p[n]}}}else{for(n in p){if(typeof p[n]==="string"){q[n]=p[n]}}}return q}function b(n){var m,o;for(m in n){o=n[m];if(o==null||h.isFunction(o)||m in c||(/scrollbar/).test(m)||(!(/color/i).test(m)&&isNaN(parseFloat(o)))){delete n[m]}}return n}function i(m,o){var p={_:0},n;for(n in o){if(m[n]!=o[n]){p[n]=o[n]}}return p}h.effects.animateClass=function(m,n,p,o){if(h.isFunction(p)){o=p;p=null}return this.queue("fx",function(){var u=h(this),r=u.attr("style")||" ",w=b(g.call(this)),t,s=u.attr("className");h.each(f,function(x,y){if(m[y]){u[y+"Class"](m[y])}});t=b(g.call(this));u.attr("className",s);u.animate(i(w,t),n,p,function(){h.each(f,function(x,y){if(m[y]){u[y+"Class"](m[y])}});if(typeof u.attr("style")=="object"){u.attr("style").cssText="";u.attr("style").cssText=r}else{u.attr("style",r)}if(o){o.apply(this,arguments)}});var q=h.queue(this),v=q.splice(q.length-1,1)[0];q.splice(1,0,v);h.dequeue(this)})};h.fn.extend({_addClass:h.fn.addClass,addClass:function(n,m,p,o){return m?h.effects.animateClass.apply(this,[{add:n},m,p,o]):this._addClass(n)},_removeClass:h.fn.removeClass,removeClass:function(n,m,p,o){return m?h.effects.animateClass.apply(this,[{remove:n},m,p,o]):this._removeClass(n)},_toggleClass:h.fn.toggleClass,toggleClass:function(o,n,m,q,p){if(typeof n=="boolean"||n===e){if(!m){return this._toggleClass(o,n)}else{return h.effects.animateClass.apply(this,[(n?{add:o}:{remove:o}),m,q,p])}}else{return h.effects.animateClass.apply(this,[{toggle:o},n,m,q])}},switchClass:function(m,o,n,q,p){return h.effects.animateClass.apply(this,[{add:o,remove:m},n,q,p])}});h.extend(h.effects,{version:"1.8.11",save:function(n,o){for(var m=0;m<o.length;m++){if(o[m]!==null){n.data("ec.storage."+o[m],n[0].style[o[m]])}}},restore:function(n,o){for(var m=0;m<o.length;m++){if(o[m]!==null){n.css(o[m],n.data("ec.storage."+o[m]))}}},setMode:function(m,n){if(n=="toggle"){n=m.is(":hidden")?"show":"hide"}return n},getBaseline:function(n,o){var p,m;switch(n[0]){case"top":p=0;break;case"middle":p=0.5;break;case"bottom":p=1;break;default:p=n[0]/o.height}switch(n[1]){case"left":m=0;break;case"center":m=0.5;break;case"right":m=1;break;default:m=n[1]/o.width}return{x:m,y:p}},createWrapper:function(m){if(m.parent().is(".ui-effects-wrapper")){return m.parent()}var n={width:m.outerWidth(true),height:m.outerHeight(true),"float":m.css("float")},o=h("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0});m.wrap(o);o=m.parent();if(m.css("position")=="static"){o.css({position:"relative"});m.css({position:"relative"})}else{h.extend(n,{position:m.css("position"),zIndex:m.css("z-index")});h.each(["top","left","bottom","right"],function(p,q){n[q]=m.css(q);if(isNaN(parseInt(n[q],10))){n[q]="auto"}});m.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})}return o.css(n).show()},removeWrapper:function(m){if(m.parent().is(".ui-effects-wrapper")){return m.parent().replaceWith(m)}return m},setTransition:function(n,p,m,o){o=o||{};h.each(p,function(r,q){unit=n.cssUnit(q);if(unit[0]>0){o[q]=unit[0]*m+unit[1]}});return o}});function d(n,m,o,p){if(typeof n=="object"){p=m;o=null;m=n;n=m.effect}if(h.isFunction(m)){p=m;o=null;m={}}if(typeof m=="number"||h.fx.speeds[m]){p=o;o=m;m={}}if(h.isFunction(o)){p=o;o=null}m=m||{};o=o||m.duration;o=h.fx.off?0:typeof o=="number"?o:o in h.fx.speeds?h.fx.speeds[o]:h.fx.speeds._default;p=p||m.complete;return[n,m,o,p]}function k(m){if(!m||typeof m==="number"||h.fx.speeds[m]){return true}if(typeof m==="string"&&!h.effects[m]){return true}return false}h.fn.extend({effect:function(p,o,r,t){var n=d.apply(this,arguments),q={options:n[1],duration:n[2],callback:n[3]},s=q.options.mode,m=h.effects[p];if(h.fx.off||!m){if(s){return this[s](q.duration,q.callback)}else{return this.each(function(){if(q.callback){q.callback.call(this)}})}}return m.call(this,q)},_show:h.fn.show,show:function(n){if(k(n)){return this._show.apply(this,arguments)}else{var m=d.apply(this,arguments);m[1].mode="show";return this.effect.apply(this,m)}},_hide:h.fn.hide,hide:function(n){if(k(n)){return this._hide.apply(this,arguments)}else{var m=d.apply(this,arguments);m[1].mode="hide";return this.effect.apply(this,m)}},__toggle:h.fn.toggle,toggle:function(n){if(k(n)||typeof n==="boolean"||h.isFunction(n)){return this.__toggle.apply(this,arguments)}else{var m=d.apply(this,arguments);m[1].mode="toggle";return this.effect.apply(this,m)}},cssUnit:function(m){var n=this.css(m),o=[];h.each(["em","px","%","pt"],function(p,q){if(n.indexOf(q)>0){o=[parseFloat(n),q]}});return o}});h.easing.jswing=h.easing.swing;h.extend(h.easing,{def:"easeOutQuad",swing:function(n,o,m,q,p){return h.easing[h.easing.def](n,o,m,q,p)},easeInQuad:function(n,o,m,q,p){return q*(o/=p)*o+m},easeOutQuad:function(n,o,m,q,p){return -q*(o/=p)*(o-2)+m},easeInOutQuad:function(n,o,m,q,p){if((o/=p/2)<1){return q/2*o*o+m}return -q/2*((--o)*(o-2)-1)+m},easeInCubic:function(n,o,m,q,p){return q*(o/=p)*o*o+m},easeOutCubic:function(n,o,m,q,p){return q*((o=o/p-1)*o*o+1)+m},easeInOutCubic:function(n,o,m,q,p){if((o/=p/2)<1){return q/2*o*o*o+m}return q/2*((o-=2)*o*o+2)+m},easeInQuart:function(n,o,m,q,p){return q*(o/=p)*o*o*o+m},easeOutQuart:function(n,o,m,q,p){return -q*((o=o/p-1)*o*o*o-1)+m},easeInOutQuart:function(n,o,m,q,p){if((o/=p/2)<1){return q/2*o*o*o*o+m}return -q/2*((o-=2)*o*o*o-2)+m},easeInQuint:function(n,o,m,q,p){return q*(o/=p)*o*o*o*o+m},easeOutQuint:function(n,o,m,q,p){return q*((o=o/p-1)*o*o*o*o+1)+m},easeInOutQuint:function(n,o,m,q,p){if((o/=p/2)<1){return q/2*o*o*o*o*o+m}return q/2*((o-=2)*o*o*o*o+2)+m},easeInSine:function(n,o,m,q,p){return -q*Math.cos(o/p*(Math.PI/2))+q+m},easeOutSine:function(n,o,m,q,p){return q*Math.sin(o/p*(Math.PI/2))+m},easeInOutSine:function(n,o,m,q,p){return -q/2*(Math.cos(Math.PI*o/p)-1)+m},easeInExpo:function(n,o,m,q,p){return(o==0)?m:q*Math.pow(2,10*(o/p-1))+m},easeOutExpo:function(n,o,m,q,p){return(o==p)?m+q:q*(-Math.pow(2,-10*o/p)+1)+m},easeInOutExpo:function(n,o,m,q,p){if(o==0){return m}if(o==p){return m+q}if((o/=p/2)<1){return q/2*Math.pow(2,10*(o-1))+m}return q/2*(-Math.pow(2,-10*--o)+2)+m},easeInCirc:function(n,o,m,q,p){return -q*(Math.sqrt(1-(o/=p)*o)-1)+m},easeOutCirc:function(n,o,m,q,p){return q*Math.sqrt(1-(o=o/p-1)*o)+m},easeInOutCirc:function(n,o,m,q,p){if((o/=p/2)<1){return -q/2*(Math.sqrt(1-o*o)-1)+m}return q/2*(Math.sqrt(1-(o-=2)*o)+1)+m},easeInElastic:function(n,q,m,w,v){var r=1.70158;var u=0;var o=w;if(q==0){return m}if((q/=v)==1){return m+w}if(!u){u=v*0.3}if(o<Math.abs(w)){o=w;var r=u/4}else{var r=u/(2*Math.PI)*Math.asin(w/o)}return -(o*Math.pow(2,10*(q-=1))*Math.sin((q*v-r)*(2*Math.PI)/u))+m},easeOutElastic:function(n,q,m,w,v){var r=1.70158;var u=0;var o=w;if(q==0){return m}if((q/=v)==1){return m+w}if(!u){u=v*0.3}if(o<Math.abs(w)){o=w;var r=u/4}else{var r=u/(2*Math.PI)*Math.asin(w/o)}return o*Math.pow(2,-10*q)*Math.sin((q*v-r)*(2*Math.PI)/u)+w+m},easeInOutElastic:function(n,q,m,w,v){var r=1.70158;var u=0;var o=w;if(q==0){return m}if((q/=v/2)==2){return m+w}if(!u){u=v*(0.3*1.5)}if(o<Math.abs(w)){o=w;var r=u/4}else{var r=u/(2*Math.PI)*Math.asin(w/o)}if(q<1){return -0.5*(o*Math.pow(2,10*(q-=1))*Math.sin((q*v-r)*(2*Math.PI)/u))+m}return o*Math.pow(2,-10*(q-=1))*Math.sin((q*v-r)*(2*Math.PI)/u)*0.5+w+m},easeInBack:function(n,o,m,r,q,p){if(p==e){p=1.70158}return r*(o/=q)*o*((p+1)*o-p)+m},easeOutBack:function(n,o,m,r,q,p){if(p==e){p=1.70158}return r*((o=o/q-1)*o*((p+1)*o+p)+1)+m},easeInOutBack:function(n,o,m,r,q,p){if(p==e){p=1.70158}if((o/=q/2)<1){return r/2*(o*o*(((p*=(1.525))+1)*o-p))+m}return r/2*((o-=2)*o*(((p*=(1.525))+1)*o+p)+2)+m},easeInBounce:function(n,o,m,q,p){return q-h.easing.easeOutBounce(n,p-o,0,q,p)+m},easeOutBounce:function(n,o,m,q,p){if((o/=p)<(1/2.75)){return q*(7.5625*o*o)+m}else{if(o<(2/2.75)){return q*(7.5625*(o-=(1.5/2.75))*o+0.75)+m}else{if(o<(2.5/2.75)){return q*(7.5625*(o-=(2.25/2.75))*o+0.9375)+m}else{return q*(7.5625*(o-=(2.625/2.75))*o+0.984375)+m}}}},easeInOutBounce:function(n,o,m,q,p){if(o<p/2){return h.easing.easeInBounce(n,o*2,0,q,p)*0.5+m}return h.easing.easeOutBounce(n,o*2-p,0,q,p)*0.5+q*0.5+m}})})(jQuery);
(function(a,b){a.effects.slide=function(c){return this.queue(function(){var f=a(this),e=["position","top","bottom","left","right"];var j=a.effects.setMode(f,c.options.mode||"show");var i=c.options.direction||"left";a.effects.save(f,e);f.show();a.effects.createWrapper(f).css({overflow:"hidden"});var g=(i=="up"||i=="down")?"top":"left";var d=(i=="up"||i=="left")?"pos":"neg";var k=c.options.distance||(g=="top"?f.outerHeight({margin:true}):f.outerWidth({margin:true}));if(j=="show"){f.css(g,d=="pos"?(isNaN(k)?"-"+k:-k):k)}var h={};h[g]=(j=="show"?(d=="pos"?"+=":"-="):(d=="pos"?"-=":"+="))+k;f.animate(h,{queue:false,duration:c.duration,easing:c.options.easing,complete:function(){if(j=="hide"){f.hide()}a.effects.restore(f,e);a.effects.removeWrapper(f);if(c.callback){c.callback.apply(this,arguments)}f.dequeue()}})})}})(jQuery);
(function(g){if(g.iCard){return}var i=window;var l=g.browser.msie&&parseFloat(g.browser.version)<7;function m(){if(g.cookie&&g.ppDialog&&!g.cookie("ppinf")){g.ppDialog({appId:"1019",regRedirectUrl:location.href,title:"想要查看更多精彩内容，马上登录吧！",onLogin:function(q){location.reload()}});return false}return true}function o(q){if(g.alert){g.alert(q)}else{alert(q)}}var j=null;var e=false;var p=function(q){var r={onAccept:null,onCancel:null};this.opts=g.extend(r,q);this.init()};p.prototype={init:function(){var q=this;this.$container=g('<div class="card-win-wrapper" style="z-index:520"></div>');var r=['<div class="card-win-con">确定不再跟随？</div>','<div class="card-win-btn">','<a href="#" class="accept">确定</a>','<a href="#" class="cancel">取消</a>',"</div>"].join("");this.$container.html(r).appendTo("body");this.$container.find("a.accept").bind("click",function(s){s.preventDefault();if(g.isFunction(q.opts.onAccept)&&q.opts.onAccept.call(q)===false){return false}q.close()});this.$container.find("a.cancel").bind("click",function(s){s.preventDefault();if(g.isFunction(q.opts.onCancel)&&q.opts.onCancel.call(q)===false){return false}q.close()})},dlg:function(){return this.$container},close:function(){this.$container.hide()},destroy:function(){this.$container.find("a.accept,a.cancel").unbind("click");this.$container.remove()}};var k=0;var c=[];function f(s,r){var u=g(s).eq(0);if(u.data("iCardInstanceExt")){u.data("iCardInstanceExt").destroy()}u.data("iCardInstanceExt",r);for(var t=0,q=c.length;t<q;t+=1){if(c[t][0]===u[0]){break}}if(t>=q){c[c.length]=u}}function n(q){var r=g(q).eq(0);if(r.data("iCardInstanceExt")){r.data("iCardInstanceExt").destroy()}}function b(s){for(var r=0,q=c.length;r<q;r+=1){if(c[r].data("iCardInstanceExt")&&c[r].data("iCardInstanceExt")!==s){c[r].data("iCardInstanceExt").hide()}}}function a(){for(var r=0,q=c.length;r<q;r+=1){if(c[r].data("iCardInstanceExt")){c[r].data("iCardInstanceExt").clearCache()}}}function d(){for(var s=0,q=c.length;s<q;s+=1){var r=c[s].data("iCardInstanceExt");if(r&&r.isVisible()){return r}}return null}var h=function(q){var r={params:{},type:"ext",bindElement:"",autoBindEvent:true,getcard:"http://i.sohu.com/a/usercard/exp/getcard.do?callback=?",getnickcard:"http://i.sohu.com/a/usercard/exp/getnickcard.do?callback=?&_input_encode=UTF-8",follow:"http://i.sohu.com/a/app/friend/friend/add.do?callback=?",unFollow:"http://i.sohu.com/a/app/friend/friend/delete.do?callback=?",maxHeight:170,ajaxDelay:300,fromType:"usercard",side:"auto",onCreateGroup:null,onSetGroup:null,onFollow:null,onUnfollow:null,onSetDesc:null};this.options=g.extend(r,q||{});if(this.options.bindElement!=""&&!g(this.options.bindElement).length){return}if(k==0){g("body").bind("click.icard",function(t){var s=d();if(s&&!g(t.target).closest(".card-box,.card-box-dialog").length){s.hide()}})}this.instanceId="iCardInstanceExt"+(++k);this.cache={};this.ajaxTimeoutId=null;this.timeoutID=null;this.init();this.bindEvent()};h.prototype={init:function(){var q=this;var r='<div class="jt-right"></div><div class="jt-top"></div><div class="jt-bottom"></div>';r+='<div class="card-con">';r+="</div>";this.container=g('<div class="card-box" id="'+this.instanceId+'"></div>');this.container.css({position:"absolute",zIndex:"510"}).html(r).appendTo("body");this.container.hide();this.$fixmask=g("<div></div>").css({position:"absolute",opacity:0,backgroundColor:"#ffffff"}).appendTo(this.container);this.container.bind("mouseenter."+this.instanceId,function(){if(q.timeoutID){clearTimeout(q.timeoutID)}}).bind("mouseleave."+this.instanceId,function(){if(!j){q.hide(0)}}).bind("click."+this.instanceId,function(v){var s=g(v.target),u=q.container.data("xpt"),t=q.container.data("friendid"),w=q.container.data("groupids");if(s.closest(".card-unfollow").length){v.preventDefault();q.unfollow(v)}else{if(s.closest(".card-follow").length){v.preventDefault();q.follow()}}});if(l){this.iframe=g('<iframe frameborder="0" tabindex="-1" src="about:blank" style="position:absolute;z-index:'+this.container.css("z-index")+';display:block;cursor:default;opacity:0;filter:alpha(opacity=0);"></iframe>').insertBefore(this.container).hide()}if(this.options.bindElement!=""){n(this.options.bindElement);f(this.options.bindElement,this)}else{n("body");f("body",this)}},bindEvent:function(){var q=this,r;if(this.options.bindElement!=""){r=g(this.options.bindElement).eq(0)}else{r=g("body")}if(this.options.autoBindEvent){r.delegate("[data-card]","mouseenter."+this.instanceId,function(s){q.show(g(this),{})}).delegate("[data-card]","mouseleave."+this.instanceId,function(s){q.hide(1000)})}},position:function(B){var E,D,C=this.options.side,t=g(i),A=t.width(),u=t.scrollTop(),G=30,z=B.offset(),w=this.container.width(),r=this.container.height(),s=this.container.find(".jt-right"),q=this.container.find(".jt-top"),F=this.container.find(".jt-bottom"),v=this.getParam(B.attr("data-card-action")),H=r>this.options.maxHeight?r:this.options.maxHeight;if(this.container.outerWidth()+z.left>A){C="left"}if(C=="left"){s.show();q.hide();F.hide();E=z.left-w-s.width();D=z.top-s.position().top+B.height()/2-s.height()/2;this.$fixmask.css({top:0,right:-10,left:"auto",bottom:"auto",width:12,height:r})}else{if(z.top-H-u-G-2>=0){E=z.left;D=z.top-r-F.height()+2;s.hide();q.hide();F.show();this.$fixmask.css({left:0,right:"auto",top:"auto",width:w,height:12});if(l){this.$fixmask.css({top:this.container.outerHeight()-8})}else{this.$fixmask.css({bottom:-10})}}else{E=z.left;D=z.top+B.height()+q.height()-2;s.hide();q.show();F.hide();this.$fixmask.css({top:-10,left:0,right:"auto",bottom:"auto",width:w,height:12})}}this.container.css({top:D,left:E});if(this.iframe){this.iframe.css({top:this.container.css("top"),left:this.container.css("left"),width:this.container.outerWidth(),height:this.container.outerHeight()}).show()}},show:function(v,r){if(this.timeoutID){clearTimeout(this.timeoutID)}if(this.ajaxTimeoutId){clearTimeout(this.ajaxTimeoutId)}var y=this,x=v.attr("data-card"),u=v.attr("data-card-action");if(!v.data("data-card-instanceId")){v.data("data-card-instanceId",this.instanceId)}if(x=="false"||x==false||e||(v.data("data-card-instanceId")!=this.instanceId)){return}b(this);var s,w;var t=this.getParam(u),q=this.getCacheData(u);if(this.options.ajaxDelay>0){this.ajaxTimeoutId=setTimeout(function(){if(q){y.setHTML(q)}else{y.loadCard(v,r)}y.container.data("paramStr",u);y.container.show();y.position(v);y.destroyUnfollowDialog()},this.options.ajaxDelay)}else{if(q){this.setHTML(q)}else{this.loadCard(v,r)}this.container.data("paramStr",u);this.container.show();this.position(v);this.destroyUnfollowDialog()}},hide:function(r){var q=this;if(!this.isVisible()){if(this.ajaxTimeoutId){clearTimeout(this.ajaxTimeoutId)}return}if(r>0){this.timeoutID=setTimeout(function(){q.container.hide();if(q.iframe){q.iframe.hide()}q.destroyUnfollowDialog()},r)}else{this.container.hide();if(this.iframe){this.iframe.hide()}this.destroyUnfollowDialog()}},destroyUnfollowDialog:function(){if(j){j.destroy();j=null;e=false}},loading:function(){this.setHTML('<div class="data-load"><div class="data-load-icon"></div>正在加载，请稍候...</div>')},loadCard:function(t,v){var q=this,u=t.attr("data-card-action"),r,s;var w=g.extend(this.getParam(u),this.options.params);if(w.xpt){r=this.options.getcard}else{if(w.nick){r=this.options.getnickcard}else{this.setHTML('<div class="data-error">抱歉，该用户无法访问</div>');return}}this.loading();g.ajax({url:r,data:w,dataType:"jsonp",scriptCharset:"GBK",cache:false,success:function(x){if(x.code==0){q.setCacheData(u,x.data);q.setHTML(x.data)}else{q.setHTML('<div class="data-load">'+x.msg+"</div>")}q.position(t)}})},getParam:function(w){if(!w){return{}}var t=w.split("&");var v={},q,s,u;for(var r=0;r<t.length;r+=1){q=t[r].indexOf("=");s=t[r].substring(0,q);u=t[r].substring(q+1);v[s]=u}return v},setCacheData:function(q,r){return this.cache[q]=r},getCacheData:function(q){if(this.cache[q]){return this.cache[q]}return null},setHTML:function(r){var q;if(g.isPlainObject(r)){q=r.view.replace(/(\r?\n)|\t/g,"");this.container.data("friendid",r.friendid||"");this.container.data("xpt",r.xpt||"");this.container.data("groupids",r.groupids||"");this.container.data("nick",r.nick||"")}else{q=r}this.container.find(".card-con").html(q)},follow:function(){var s=this,t=this.container.data("paramStr"),r=this.container.data("xpt"),q=this.container.data("friendid"),u=this.container.data("groupids");var v=g.extend(this.getParam(t),this.options.params);if(!h.login()){return}g.ajax({url:this.options.follow,data:{xpt:r,from_type:this.options.fromType,product:v.product||"out_website"},dataType:"jsonp",scriptCharset:"GBK",cache:false,success:function(w){if(w.code==1||w.code==-2){if(w.data.friendType==1){s.container.find("span.card-button-attention,span.card-button-attention-add").replaceWith('<span class="card-button-attention-each-other"><em>互相跟随</em><a class="card-unfollow" href="#">取消</a></span>')}else{s.container.find("span.card-button-attention,span.card-button-attention-add").replaceWith('<span class="card-button-attention-already"><em>已跟随</em><a class="card-unfollow" href="#">取消</a></span>')}a();s.setCacheData(t,null);s.container.data("friendid",w.data.friendId);s.container.data("groupids","");s.followMode();if(g.isFunction(s.options.onFollow)){s.options.onFollow({xpt:r,friendid:q,friendType:w.data.friendType})}}else{o(w.msg)}}})},unfollow:function(q){var B=this,x=this.container.data("paramStr"),r=this.container.data("xpt"),t=this.container.data("friendid"),s=this.container.data("groupids");if(!h.login()||e||(j&&j.dlg().is(":visible"))){return}this.destroyUnfollowDialog();var u=g(q.target).parent();var y=u.offset();var v=new p({onAccept:function(){g.ajax({url:B.options.unFollow,data:{xpt:r},dataType:"jsonp",scriptCharset:"UTF-8",cache:false,success:function(C){if(C.code==1){if(C.data.friendType==1){B.container.find("span.card-button-attention-already,span.card-button-attention-each-other").replaceWith('<span class="card-button-attention-add"><a class="card-follow" href="#">跟随</a></span>')}else{B.container.find("span.card-button-attention-already,span.card-button-attention-each-other").replaceWith('<span class="card-button-attention"><a class="card-follow" href="#">跟随</a></span>')}a();B.setCacheData(x,null);B.unFollowMode();if(g.isFunction(B.options.onUnfollow)){B.options.onUnfollow({xpt:r,friendid:t,groupids:s,friendType:C.data.friendType})}}else{o(C.msg)}}});B.destroyUnfollowDialog();return false},onCancel:function(){e=true;this.dlg().hide("slide",{direction:"down"},function(){B.destroyUnfollowDialog()});return false}});var w=y.top-v.dlg().outerHeight()-2;var A=y.left+(u.outerWidth()-v.dlg().outerWidth())/2;var z=g(i).width();if(w<0){w=0}if((A+v.dlg().outerWidth())>z){A=z-v.dlg().outerWidth()-10}e=true;j=v;v.dlg().css({top:w,left:A}).show("slide",{direction:"down"},function(){e=false})},followMode:function(){return},unFollowMode:function(){return},isVisible:function(){return this.container.is(":visible")},clearCache:function(){this.cache={}},destroy:function(){var q=this,r;if(this.options.bindElement!=""){r=g(this.options.bindElement).eq(0)}else{r=g("body")}if(this.options.autoBindEvent){r.unbind("."+this.instanceId).undelegate("."+this.instanceId)}r.removeData("iCardInstanceExt");g("body").unbind("."+this.instanceId);this.container.unbind("."+this.instanceId);this.container.remove()}};h.destroyInstance=n;h.login=m;g.iCard=h;g(function(){g("[data-card-handle]").each(function(){var r=g(this),s=h.prototype.getParam(r.attr("data-card-handle")||"");var q=new h({bindElement:r,params:s})})})})(jQuery);
